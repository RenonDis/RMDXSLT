<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<xsl:output method="html" encoding="utf-8"></xsl:output>

<xsl:template match="/ponctualite-transilien">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
  <head>
    <link rel="stylesheet" type="text/css" href="style_trains.css"/>
  </head>
  <body>

    <xsl:variable name="minmax">
      <xsl:for-each select="//mesure">
        <xsl:sort select="../@millesime"/>
        <xsl:sort select="@mois"/>
        <xsl:if test="position() = 1">
            <xsl:value-of select="@mois"/>-<xsl:value-of select="../@millesime"/>
        </xsl:if>
        <xsl:if test="position() = last()">
        au
            <xsl:value-of select="@mois"/>-<xsl:value-of select="../@millesime"/>
        </xsl:if>
      </xsl:for-each>
    </xsl:variable>
    
    
    <h1>PonctualitÃ© du transilien du <xsl:value-of select="$minmax"/> </h1>
      
  <xsl:apply-templates/>

  </body>
</html>
</xsl:template>

<xsl:template match="service">
<div>
    <xsl:apply-templates/>
</div>
</xsl:template>

<xsl:template match="ligne">
<xsl:value-of select="@nom"/>
<table border="2">
    <tr>
        <th>Date</th>
        <th>Mesure</th>
        <th>Satisfaction</th>
    </tr>
    <xsl:for-each select="annee/mesure">
      <xsl:sort select="../@millesime"/>
      <xsl:sort select="@mois"/>
      <tr>
           <td><xsl:value-of select="../@millesime"/>-<xsl:value-of select="@mois"/></td> 
           <td><xsl:apply-templates select="ponctualite"></xsl:apply-templates></td> 
           <td><xsl:apply-templates select="satisfaction"></xsl:apply-templates></td>
      </tr>
     </xsl:for-each>
</table>
</xsl:template>

</xsl:stylesheet>
